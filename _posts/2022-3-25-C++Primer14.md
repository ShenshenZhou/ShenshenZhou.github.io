---

title: C++Primer5 第14章 重载运算符和类型转换 
date: 2022-3-25 23:35:10 +0800
tags: [笔记,C++Primer5,C++]
categories: [笔记,C++Primer5]

---

**说明：**通过重载类间运算符完成类对象之间的类型转换。

### 基本概念

1、重载运算符函数的参数数量与该运算符作用的运算对象数量一样多。

注意：如果是成员函数，因为this绑定到左侧运算对象，所以成员运算符的参数数量比运算对象的数量少一个。

2、对于一个运算符函数来说，它或者是类的成员，或者至少含有一个类类型的参数。

> 如果都是内置类型的话，运算符的含义无法改变，就无意义了。

3、选择作为成员函数或者非成员函数？

在某些时候别无选择，因为有的运算符必须作为成员；其它情况下，运算符作为普通函数比作为成员函数更好。

> 为什么更好？因为作为成员函数，它的左侧运算对象必须是运算符所属类的一个对象，左侧运算对象调用运算符函数完成运算。
>
> ```c++
> string s = "world";  // 如果operator+是成员函数的话
> string t = s + "!";  // 正确 s.operator+("!")
> string u = "hi" + s;  // 错误 "hi".operator+(s)
> ```

* 幅值=、下标[]、调动()、成员访问箭头->运算符必须是成员；
* 复合赋值运算符一般来说应该是成员，但并非必须；
* 改变对象运算状态或者与给定类型密切相关的运算符，如递增、递减和解引用运算符，通常应该是成员；
* 具有对称性的运算符可能转换任意一端的运算对象，如算术、相等性、关系和位运算符等，通常是非成员函数。

### 输入和输出运算符

#### 重载输出运算符<<

```c++
ostream &operator<<(ostream &os, const Sales_data &item{
    os << item.isbn << " " ;
    return os;
}
```

* 第一个形参是一个非常量ostream对象的引用，之所以是非常量，是因为向流写入内容会改变其状态，该形参是引用是因为我们无法直接赋值一个ostream对象。
* 第二个参数是常量引用，引用是因为我们希望避免复制实参，常量是因为打印对象不会改变对象的内容。
* 为了与其它输出运算符保持一致，operator<<返回它的ostream形参。

> 1、输出运算符因避免格式化操作，主要负责打印内容而非控制格式。
>
> 2、必须是非成员函数，否则，它的左侧运算对象是类的一个对象！

#### 重载输入运算符>>

```c++
istream &operator>>(istream &is, Salse_data &item) {
    double price;  // 不需要初始化 因为我们会读入它
    is >> items.bookNo >> item.units_sold >> price;
    // 输入检查！！！
    if (is) {
		items.revenue = item.units_sold * price;
    } else {
        item = Sales_data();  // 输入失败 对象被赋予默认状态
    }
    return is;
}
```

* 第一个参数是读取流的引用
* 第二个参数非常量，因为目的就是将数据读入这个对象中
* 返回某个给定流的引用

> 注意：必须处理输入可能失败的情况，重载输出运算符不用。
>
> 输入错误可能有类型错误或者读到文件末尾或其它错误。

### 算术和关系运算符

1、因左侧和右侧运算对象可以进行转换，一般为非成员函数。因不需要改变运算对象的状态，所以形参都是常量引用。

2、如果类定义了算术运算符，一般也会定义一个对应的符合赋值运算符，此时，最有效的方法就是使用复合赋值运算符来定义算术运算符。

> 为什么？因为算术运算符会把运算结果存到一个临时的局部变量中，再返回这个局部变量的副本，而是用复合赋值运算符则可避免该消耗。

#### 相等运算符

#### 关系运算符

### 赋值运算符



